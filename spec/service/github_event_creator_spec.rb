require 'rails_helper'
require 'faraday'

describe GithubEventCreator do
  context '.create_event_create' do
    it 'it creates github_event with event_type CrateEvent' do
      payload = {"id"=>"24421650358", "type"=>"CreateEvent", "repo"=>{"id"=>545761346, "name"=>"dohoonk/fixd-challenge-social-api", "url"=>"https://api.github.com/repos/dohoonk/fixd-challenge-social-api"}, "payload"=>{"ref"=>"tony-feature-github-event", "ref_type"=>"branch", "master_branch"=>"main", "description"=>nil, "pusher_type"=>"user"}, "created_at"=>"2022-10-05T20:55:09Z"}
      github_event = GithubEventCreator.new(1).call
      

      expect(github_event.event_type).to eq("CreateEvent")
      expect(GithubEvent.count).to eq(1)
    end
  end
end


# payload = {"id"=>"24421999838", "type"=>"PushEvent", "actor"=>{"id"=>16655880, "login"=>"dohoonk", "display_login"=>"dohoonk", "gravatar_id"=>"", "url"=>"https://api.github.com/users/dohoonk", "avatar_url"=>"https://avatars.githubusercontent.com/u/16655880?"}, "repo"=>{"id"=>545761346, "name"=>"dohoonk/fixd-challenge-social-api", "url"=>"https://api.github.com/repos/dohoonk/fixd-challenge-social-api"}, "payload"=>{"push_id"=>11237696607, "size"=>7, "distinct_size"=>1, "ref"=>"refs/heads/main", "head"=>"1f65beb808d671af208690198bcc5d7ce4ffa531", "before"=>"86b76f93865c699c59d66f881b55020e17ef76a7", "commits"=>[{"sha"=>"1779ec6078abb1fb8eba860d3b99fee5baafea46", "author"=>{"email"=>"dohoonk.smg@gmail.com", "name"=>"Tony(Dohoon) Kim"}, "message"=>"Add github_event model and associations", "distinct"=>false, "url"=>"https://api.github.com/repos/dohoonk/fixd-challenge-social-api/commits/1779ec6078abb1fb8eba860d3b99fee5baafea46"}, {"sha"=>"f17520f0858990cf9b17917b797b3886ecd5ce1e", "author"=>{"email"=>"dohoonk.smg@gmail.com", "name"=>"Tony(Dohoon) Kim"}, "message"=>"Fix user model to have github_username attribute", "distinct"=>false, "url"=>"https://api.github.com/repos/dohoonk/fixd-challenge-social-api/commits/f17520f0858990cf9b17917b797b3886ecd5ce1e"}, {"sha"=>"e997ceaf284de37030abe46a38aba44434397a9a", "author"=>{"email"=>"dohoonk.smg@gmail.com", "name"=>"Tony(Dohoon) Kim"}, "message"=>"Add factory github_event model for test data and fix factory user model to add github_username", "distinct"=>false, "url"=>"https://api.github.com/repos/dohoonk/fixd-challenge-social-api/commits/e997ceaf284de37030abe46a38aba44434397a9a"}, {"sha"=>"8a45e609da0cb6456e8dcfa9eb3a7b102d77c29b", "author"=>{"email"=>"dohoonk.smg@gmail.com", "name"=>"Tony(Dohoon) Kim"}, "message"=>"Add routes for github_events", "distinct"=>false, "url"=>"https://api.github.com/repos/dohoonk/fixd-challenge-social-api/commits/8a45e609da0cb6456e8dcfa9eb3a7b102d77c29b"}, {"sha"=>"1771f56cc9414aec37bcbca419419e3375a797bf", "author"=>{"email"=>"dohoonk.smg@gmail.com", "name"=>"Tony(Dohoon) Kim"}, "message"=>"Add github_events create controller to generate github_events from github public events api", "distinct"=>false, "url"=>"https://api.github.com/repos/dohoonk/fixd-challenge-social-api/commits/1771f56cc9414aec37bcbca419419e3375a797bf"}, {"sha"=>"23dfeee10fdfdb2de10f08809806362e2c8ebd3c", "author"=>{"email"=>"dohoonk.smg@gmail.com", "name"=>"Tony(Dohoon) Kim"}, "message"=>"WIP add testing for github_events endpoint", "distinct"=>false, "url"=>"https://api.github.com/repos/dohoonk/fixd-challenge-social-api/commits/23dfeee10fdfdb2de10f08809806362e2c8ebd3c"}, {"sha"=>"1f65beb808d671af208690198bcc5d7ce4ffa531", "author"=>{"email"=>"dohoonk.smg@gmail.com", "name"=>"Tony(Dohoon) Kim"}, "message"=>"Merge pull request #5 from dohoonk/tony-feature-github-event\n\nTony feature github_event", "distinct"=>true, "url"=>"https://api.github.com/repos/dohoonk/fixd-challenge-social-api/commits/1f65beb808d671af208690198bcc5d7ce4ffa531"}]}, "public"=>true, "created_at"=>"2022-10-05T21:15:28Z"}
